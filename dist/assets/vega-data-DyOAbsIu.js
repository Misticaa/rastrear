console.warn("‚ö†Ô∏è Configura√ß√µes do Supabase n√£o definidas. Configure em src/config/supabase.js");const n=null,i=()=>n!==null;console.log("‚ö†Ô∏è Supabase n√£o configurado - usando fallback localStorage");class d{static formatCPF(t){const e=t.replace(/[^\d]/g,"");return e.length<=11?e.replace(/(\d{3})(\d{3})(\d{3})(\d{2})/,"$1.$2.$3-$4"):t}static cleanCPF(t){return t.replace(/[^\d]/g,"")}static isValidCPF(t){const e=this.cleanCPF(t);return e.length!==11||/^(\d)\1{10}$/.test(e)?!1:this.validateCPFDigits(e)}static validateCPFDigits(t){let e=0;for(let s=0;s<9;s++)e+=parseInt(t.charAt(s))*(10-s);let a=11-e%11;if((a>=10?0:a)!==parseInt(t.charAt(9)))return!1;e=0;for(let s=0;s<10;s++)e+=parseInt(t.charAt(s))*(11-s);return a=11-e%11,(a>=10?0:a)===parseInt(t.charAt(10))}static applyCPFMask(t){let e=t.value.replace(/[^\d]/g,"");return e.length>11&&(e=e.slice(0,11)),e.length>9?e=e.replace(/(\d{3})(\d{3})(\d{3})(\d{2})/,"$1.$2.$3-$4"):e.length>6?e=e.replace(/(\d{3})(\d{3})(\d{3})/,"$1.$2.$3"):e.length>3&&(e=e.replace(/(\d{3})(\d{3})/,"$1.$2")),t.value=e,e}}class u{constructor(){this.isConfigured=i(),this.isConfigured||console.warn("‚ö†Ô∏è Supabase n√£o configurado. Usando armazenamento local como fallback.")}async createLead(t){if(!this.isConfigured)return this.createLeadFallback(t);try{const e={...t,nome_completo:t.nome_completo||t.nome||"Cliente Shopee",initial_timestamp:t.initial_timestamp||new Date().toISOString(),liberation_paid:!1,delivery_attempts:0,liberation_date:null};console.log("üíæ SALVANDO LEAD NO SUPABASE:",{cpf:e.cpf,nome_completo:e.nome_completo,initial_timestamp:e.initial_timestamp});const{data:a,error:r}=await n.from("leads").insert([e]).select().single();return r?(console.error("Erro ao criar lead:",r),this.createLeadFallback(e)):(console.log("‚úÖ Lead criado no Supabase:",a),{success:!0,data:a})}catch(e){return console.error("Erro na cria√ß√£o do lead:",e),this.createLeadFallback(leadWithTimestamp)}}async getLeadByCPF(t){if(!this.isConfigured)return this.getLeadByCPFFallback(t);try{const{data:e,error:a}=await n.from("leads").select("*").eq("cpf",t.replace(/[^\d]/g,"")).single();return a&&a.code!=="PGRST116"?(console.error("Erro ao buscar lead:",a),this.getLeadByCPFFallback(t)):{success:!0,data:e||null}}catch(e){return console.error("Erro na busca do lead:",e),this.getLeadByCPFFallback(t)}}async updateLeadStage(t,e){if(!this.isConfigured)return this.updateLeadStageFallback(t,e);try{const{data:a,error:r}=await n.from("leads").update({etapa_atual:e}).eq("cpf",t.replace(/[^\d]/g,"")).select().single();return r?(console.error("Erro ao atualizar etapa:",r),this.updateLeadStageFallback(t,e)):(console.log("‚úÖ Etapa atualizada no Supabase:",a),{success:!0,data:a})}catch(a){return console.error("Erro na atualiza√ß√£o da etapa:",a),this.updateLeadStageFallback(t,e)}}async updatePaymentStatus(t,e){if(!this.isConfigured)return this.updatePaymentStatusFallback(t,e);try{const{data:a,error:r}=await n.from("leads").update({status_pagamento:e}).eq("cpf",t.replace(/[^\d]/g,"")).select().single();return r?(console.error("Erro ao atualizar status de pagamento:",r),this.updatePaymentStatusFallback(t,e)):(console.log("‚úÖ Status de pagamento atualizado no Supabase:",a),{success:!0,data:a})}catch(a){return console.error("Erro na atualiza√ß√£o do status de pagamento:",a),this.updatePaymentStatusFallback(t,e)}}async updateLeadTimeline(t,e){if(!this.isConfigured)return this.updateLeadTimelineFallback(t,e);try{const{data:a,error:r}=await n.from("leads").update({timeline_data:e,updated_at:new Date().toISOString()}).eq("cpf",t.replace(/[^\d]/g,"")).select().single();return r?(console.error("Erro ao atualizar timeline:",r),this.updateLeadTimelineFallback(t,e)):(console.log("‚úÖ Timeline atualizada no Supabase:",a),{success:!0,data:a})}catch(a){return console.error("Erro na atualiza√ß√£o da timeline:",a),this.updateLeadTimelineFallback(t,e)}}createLeadFallback(t){try{const e=JSON.parse(localStorage.getItem("leads")||"[]"),a={...t,nome_completo:t.nome_completo||t.nome||"Cliente Shopee",id:Date.now().toString(),created_at:new Date().toISOString(),updated_at:new Date().toISOString(),initial_timestamp:t.initial_timestamp||new Date().toISOString()};return console.log("üíæ SALVANDO LEAD NO LOCALSTORAGE:",{cpf:a.cpf,nome_completo:a.nome_completo,initial_timestamp:a.initial_timestamp}),e.push(a),localStorage.setItem("leads",JSON.stringify(e)),console.log("‚úÖ Lead criado no localStorage:",a),{success:!0,data:a}}catch(e){return console.error("Erro no fallback de cria√ß√£o:",e),{success:!1,error:e.message}}}getLeadByCPFFallback(t){try{return{success:!0,data:JSON.parse(localStorage.getItem("leads")||"[]").find(r=>r.cpf===t.replace(/[^\d]/g,""))||null}}catch(e){return console.error("Erro no fallback de busca:",e),{success:!1,error:e.message}}}updateLeadStageFallback(t,e){try{const a=JSON.parse(localStorage.getItem("leads")||"[]"),r=a.findIndex(o=>o.cpf===t.replace(/[^\d]/g,""));return r!==-1?(a[r].etapa_atual=e,a[r].updated_at=new Date().toISOString(),localStorage.setItem("leads",JSON.stringify(a)),console.log("‚úÖ Etapa atualizada no localStorage:",a[r]),{success:!0,data:a[r]}):{success:!1,error:"Lead n√£o encontrado"}}catch(a){return console.error("Erro no fallback de atualiza√ß√£o:",a),{success:!1,error:a.message}}}updatePaymentStatusFallback(t,e){try{const a=JSON.parse(localStorage.getItem("leads")||"[]"),r=a.findIndex(o=>o.cpf===t.replace(/[^\d]/g,""));return r!==-1?(a[r].status_pagamento=e,a[r].updated_at=new Date().toISOString(),localStorage.setItem("leads",JSON.stringify(a)),console.log("‚úÖ Status de pagamento atualizado no localStorage:",a[r]),{success:!0,data:a[r]}):{success:!1,error:"Lead n√£o encontrado"}}catch(a){return console.error("Erro no fallback de atualiza√ß√£o de pagamento:",a),{success:!1,error:a.message}}}updateLeadTimelineFallback(t,e){try{const a=JSON.parse(localStorage.getItem("leads")||"[]"),r=a.findIndex(o=>o.cpf===t.replace(/[^\d]/g,""));return r!==-1?(a[r].timeline_data=e,a[r].updated_at=new Date().toISOString(),localStorage.setItem("leads",JSON.stringify(a)),console.log("‚úÖ Timeline atualizada no localStorage:",a[r]),{success:!0,data:a[r]}):{success:!1,error:"Lead n√£o encontrado"}}catch(a){return console.error("Erro no fallback de atualiza√ß√£o de timeline:",a),{success:!1,error:a.message}}}updateLiberationStatusFallback(t,e,a){try{const r=JSON.parse(localStorage.getItem("leads")||"[]"),o=r.findIndex(s=>s.cpf===t.replace(/[^\d]/g,""));return o!==-1?(r[o].liberation_paid=e,r[o].liberation_date=a||new Date().toISOString(),r[o].updated_at=new Date().toISOString(),localStorage.setItem("leads",JSON.stringify(r)),console.log("‚úÖ Status de libera√ß√£o atualizado no localStorage:",r[o]),{success:!0,data:r[o]}):{success:!1,error:"Lead n√£o encontrado"}}catch(r){return console.error("Erro no fallback de atualiza√ß√£o de libera√ß√£o:",r),{success:!1,error:r.message}}}updateDeliveryAttemptsFallback(t,e){try{const a=JSON.parse(localStorage.getItem("leads")||"[]"),r=a.findIndex(o=>o.cpf===t.replace(/[^\d]/g,""));return r!==-1?(a[r].delivery_attempts=e,a[r].updated_at=new Date().toISOString(),localStorage.setItem("leads",JSON.stringify(a)),console.log("‚úÖ Tentativas de entrega atualizadas no localStorage:",a[r]),{success:!0,data:a[r]}):{success:!1,error:"Lead n√£o encontrado"}}catch(a){return console.error("Erro no fallback de atualiza√ß√£o de tentativas:",a),{success:!1,error:a.message}}}}class m{static parseURLParams(){const t=new URLSearchParams(window.location.search),e={},a={nome:"nome_completo",name:"nome_completo",cpf:"cpf",email:"email",telefone:"telefone",phone:"telefone",endereco:"endereco",address:"endereco",valor:"valor_total",amount:"valor_total",payment:"meio_pagamento",pagamento:"meio_pagamento"};for(const[r,o]of Object.entries(a)){const s=t.get(r);s&&(e[o]=decodeURIComponent(s))}return e.order_bumps=this.extractOrderBumps(t),e.origem="vega",e.data_compra=new Date().toISOString(),e.produtos=[{nome:"Kit 12 caixas organizadoras + brinde",preco:e.valor_total||0,imagem:"/traduza-have-you-propose copy.png"}],e}static extractOrderBumps(t){const e=[];return[{id:"bump1",nome:"Pague em At√© 5 Minutos e Ganhe Mais 3 Caixas Organizadoras",preco:0,imagem:"/traduza-have-you-propose copy.png",params:["bump1","bonus_caixas","extra_caixas"]},{id:"bump2",nome:"Leve Mais 8 Caixas Pela Metade do Pre√ßo",preco:39.9,imagem:"/traduza-have-you-propose copy.png",params:["bump2","caixas_extras","mais_caixas"]},{id:"bump3",nome:"Kit de 6 Potes Herm√©ticos",preco:29.9,imagem:"/traduza-have-you-propose copy.png",params:["bump3","potes","hermeticos"]}].forEach(r=>{r.params.some(s=>{const l=t.get(s);return l&&(l==="1"||l==="true"||l==="yes")})&&e.push(r)}),e}static generateMockVegaData(t){const e=["Jo√£o Silva Santos","Maria Oliveira Costa","Pedro Souza Lima","Ana Paula Ferreira","Carlos Eduardo Alves","Fernanda Santos Rocha"],a=["joao.silva@email.com","maria.costa@email.com","pedro.lima@email.com","ana.ferreira@email.com","carlos.alves@email.com","fernanda.rocha@email.com"],r=["Rua das Flores, 123 - Centro - S√£o Paulo/SP - CEP: 01234-567","Av. Paulista, 456 - Bela Vista - S√£o Paulo/SP - CEP: 01310-100","Rua Augusta, 789 - Consola√ß√£o - S√£o Paulo/SP - CEP: 01305-000"],o=parseInt(t.slice(-2))%e.length;return{nome_completo:e[o],cpf:t,email:a[o],telefone:`(11) 9${t.slice(-8)}`,endereco:r[o%r.length],valor_total:67.9,meio_pagamento:"PIX",origem:"vega",data_compra:new Date().toISOString(),produtos:[{nome:"Kit 12 caixas organizadoras + brinde",preco:67.9,imagem:"/traduza-have-you-propose copy.png"}],order_bumps:[{id:"bump2",nome:"Leve Mais 8 Caixas Pela Metade do Pre√ßo",preco:39.9,imagem:"/traduza-have-you-propose copy.png"}]}}static isVegaOrigin(){const t=new URLSearchParams(window.location.search);return t.get("origem")==="vega"||t.has("nome")||t.has("name")||t.has("vega")}}export{d as C,u as D,m as V,i,n as s};
